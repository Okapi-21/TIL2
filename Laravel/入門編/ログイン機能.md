## ログイン機能の実装

### Laravelのセッションとルーティングについて（初学者向けまとめ）

---

### セッションとは？

セッションは、Webアプリで「ユーザーごとの一時的なデータ」を保存・管理する仕組みです。

- ユーザーがサイトを使っている間だけ情報を記憶します。
- 例えば「ログイン状態」や「カートの中身」などをサーバー側で管理できます。
- 各ユーザーには一意の「セッションID」が発行され、Cookieとしてブラウザに保存されます。
- サーバーはセッションIDを使って、ユーザーごとの情報を区別します。

### Laravelでのセッション設定

- 設定ファイルは `config/session.php`
- デフォルトは `file` ドライバー（サーバー上のファイルとして保存）
- 他にも `cookie`, `database`, `redis` などに変更可能
    - アプリの規模や特性に応じて使い分けます

---

### ルーティング設定（Routing）

ルーティングは「URL（リクエスト）」と「コントローラの処理」を結びつける仕組みです。

- ルーティングは `routes/web.php` で定義します。
- HTTPメソッド（GET、POST、PUT、DELETEなど）とURLパターン、コントローラのアクションを指定します。

### ルート定義例

```php
Route::get('/articles', [ArticleController::class, 'index']);      // 記事一覧
Route::post('/articles', [ArticleController::class, 'store']);     // 記事投稿
Route::get('/articles/new', [ArticleController::class, 'create']); // 記事作成画面
Route::get('/articles/{id}', [ArticleController::class, 'show']);  // 記事詳細
Route::get('/articles/{id}/edit', [ArticleController::class, 'edit']); // 編集画面
Route::put('/articles/{id}', [ArticleController::class, 'update']);    // 更新
Route::delete('/articles/{id}', [ArticleController::class, 'destroy']); // 削除
```

- リクエストの内容によって、対応するコントローラのアクションが呼ばれます。
- 例えば、`GET /articles` のリクエストが来たら、`index` アクションが実行されます。

---

### リソースルーティング

複数のレコード（記事や商品など）を管理する際に便利な仕組みです。

- 1行で、CRUD（作成・取得・更新・削除）に必要なルートをまとめて自動生成します。
- 例えば：

```php
Route::resource('posts', PostController::class);
```

| ルート名      | HTTPメソッド | パス               | コントローラ@アクション |
| ------------- | ------------ | ------------------ | ----------------------- |
| posts.index   | GET          | /posts             | PostController@index    |
| posts.create  | GET          | /posts/create      | PostController@create   |
| posts.store   | POST         | /posts             | PostController@store    |
| posts.show    | GET          | /posts/{post}      | PostController@show     |
| posts.edit    | GET          | /posts/{post}/edit | PostController@edit     |
| posts.update  | PUT/PATCH    | /posts/{post}      | PostController@update   |
| posts.destroy | DELETE       | /posts/{post}      | PostController@destroy  |

### 個別ルート定義も可能

例えばユーザープロフィールの場合：

```php
Route::get('/profile', [ProfileController::class, 'show'])->name('profile.show');
Route::get('/profile/edit', [ProfileController::class, 'edit'])->name('profile.edit');
Route::put('/profile', [ProfileController::class, 'update'])->name('profile.update');
```

---

### リソースルーティングのメリット

- **設定が簡単**：1行で複数のルートを自動生成できる
- **RESTful設計**：Web標準の設計になり、他システムとの連携も容易
- **命名規則が統一**：プロジェクト全体で分かりやすく、迷いにくい
- **名前付きルートの自動生成**：`posts.index` などのルート名で呼び出せ、保守性アップ
- **ネストにも対応**：複雑な階層のデータでも直感的なURL設計が可能
- **柔軟にカスタマイズ可能**：必要なルートだけ生成したり、追加アクションも簡単

```php
// 例えば「編集・削除」だけ欲しい場合
Route::resource('posts', PostController::class)->only(['edit', 'destroy']);
```

---

### 初学者向けポイント

- ルーティングは「URLと処理を結びつける役割」と覚えましょう
- リソースルーティングは「複数データ（CRUD）をまとめて管理するための便利な仕組み」
- セッションは「ユーザーごとの一時的なデータ保存」
- 公式ドキュメントも活用して、実際に手を動かしながら覚えると理解が深まります

---

### 参考リンク

- [Laravel公式 セッション](https://laravel.com/docs/session)
- [Laravel公式 ルーティング](https://laravel.com/docs/routing)
- [Laravel公式 リソースコントローラ](https://laravel.com/docs/controllers#resource-controllers)



### Laravelログインフォーム（view）の重要ポイント（初学者向け）

```
<form action="{{route('login.store')}}" method="post">
 @csrf

        <div class="input-group mb-3">
            <input type="email" name="email" class="form-control @error('email') is-invalid @enderror"
                   value="{{ old('email') }}" placeholder="{{ __('adminlte::adminlte.email') }}" autofocus>

            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-envelope {{ config('adminlte.classes_auth_icon', '') }}"></span>
                </div>
            </div>
            
             @error('email')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>
        
        <div class="offset-7 col-5">
            <button type=submit class="btn btn-block {{ config('adminlte.classes_auth_btn', 'btn-flat btn-primary') }}">
                <span class="fas fa-sign-in-alt"></span>
                {{ __('adminlte::adminlte.sign_in') }}
            </button>
        </div>
</form>
```

---

### 1. フォームの役割

- このコードは「ログインフォーム」を作るためのものです。
- `action="{{route('login.store')}}" method="post"` で、**ログイン情報（メール・パスワード）を/loginにPOST送信**します。

---

### 2. セキュリティ対策

- `@csrf` … **CSRF（クロスサイトリクエストフォージェリ）対策のトークン**を自動挿入。
    - フォーム送信時の不正リクエストを防ぐために必須。

---

### 3. 入力欄の構成

- **メールアドレス**：  
  `<input type="email" name="email" ...>`
    - ユーザーがメールアドレスを入力。
    - `name="email"` で、送信時に「email」としてデータが送られる。
    - `value="{{ old('email') }}"` … 入力ミスで再表示時も、前回の入力値を保持。
    - エラー時は `is-invalid` クラスで見た目もエラー表示。

- **パスワード**：  
  `<input type="password" name="password" ...>`
    - ユーザーがパスワードを入力。
    - `name="password"` で、送信時に「password」としてデータが送られる。
    - エラー時は `is-invalid` クラスで見た目もエラー表示。

---

### 4. エラーメッセージの表示

- 入力欄の下に `@error('email') ... @enderror` などで**入力エラーがあればメッセージを表示**。
    - 例えば「メールアドレスが必須です」などの案内が出る。

---

### 5. 送信ボタン

- `<button type="submit">` で**ログインフォーム送信**。
    - アイコンやデザインも指定可能。

---

### 6. その他のポイント

- フォーム全体は `@extends` でテンプレート（adminlte）を継承してデザインを統一。
- 入力欄のアイコン（メール、鍵）は見やすさ・分かりやすさのため。

---

### 初学者向けまとめ

- **フォームはactionとmethodで送信先・送信方法を決める**
- **@csrfはLaravelでフォームに必ず入れる安全対策！**
- **name属性はサーバーに送る時のデータ名になる**
- **エラー時のメッセージ表示や入力値の保持はユーザーに優しい設計**
- **送信ボタンでデータを送る。デザインやアイコンは自由に工夫できる**

---




#### コメント

- view画面でリンクを渡す際にはaタグのhref属性の中にルートパスを記述すれば良い
- Login/create画面にユーザーを誘導し、その後、create画面において、storeメソッドを起動させる
  - storeにログインのための動作を組み込むことで、ログイン機能を実装することができる

