### モデル

#### モデル

　LaravelのモデルはDBへのアクセスやビジネスロジックの実装に責任を持つ部分になる。
Laravelのモデルは主に、Eloquentで実装されていて、標準で様々な機能を提供している。

#### Eloquent

　Eloquentは、LaravelのデフォルトのORM（Object-Relational Mapping）ライブラリであり、Laravelのモデル層の実装に使用される。ORMはデータベースのテーブルとオブジェクト指向プログラミングのモデルをマッピングし、DBとのやり取りを簡単にするためのツールです。

#### 命名規則

- モデルのクラス名を単数形
- テーブル名を複数形
- モデルのクラス名が複数の単語で構成されている場合
  - クラス名をキャメルケース（頭文字を大文字にする書き方）で記述
  - 対応するテーブル名はスネークケース（小文字とアンダースコアで構成する記法）で記述

#### メソッド一覧（一部）

| メソッド          | 概要・用途                                     | 例（使い方）                                                 | 備考                     |
| ----------------- | ---------------------------------------------- | ------------------------------------------------------------ | ------------------------ |
| `new`             | 新しいオブジェクトを作成。まだDB保存されない。 | `$user = new User([...]);`                                   | 保存は `save` メソッドで |
| `save`            | オブジェクトをDBに保存（新規・更新）。         | `$user->save();`                                             |                          |
| `create`          | 新規レコードを直接DBに保存。                   | `$user = User::create([...]);`                               | バリデーションは事前に   |
| `all`             | 全レコードを取得。                             | `$users = User::all();`                                      |                          |
| `find`            | ID指定で1件取得。なければ `null`。             | `$user = User::find(1);`                                     |                          |
| `findOrFail`      | ID指定で1件取得。なければ例外をスロー。        | `$user = User::findOrFail(1);`                               |                          |
| `where`           | 条件指定で取得。                               | `$users = User::where('name', 'RUNTEQ')->get();`             | 複数件返る               |
| `update`          | 既存レコードを更新。                           | `$user->update(['name' => 'Runtekun']);`                     |                          |
| `delete`          | レコードを削除。                               | `$user->delete();`                                           |                          |
| `destroy`         | ID指定で直接削除。複数IDも可。                 | `User::destroy(1);`<br>`User::destroy([1, 2, 3]);`           |                          |
| `orderBy`         | 並び順指定で取得。                             | `$users = User::orderBy('name')->get();`<br>`orderBy('name','desc')` | 昇順/降順両方可          |
| `count`           | レコード数を取得。                             | `$total = User::count();`<br>`User::where('age', '>=', 18)->count();` | 条件付きも可             |
| `latest`/`oldest` | 作成日時で並び替え（降順/昇順）。              | `$lastUser = User::latest()->first();`                       | `created_at`基準         |
| `first`           | 取得した中で最初の1件を返す。                  | `$firstUser = User::first();`                                | 条件付きも可             |

---

> **補足**  
> - 取得結果がない場合、`first`, `find`は`null`を返します。  
> - 例外が必要な場合は`findOrFail`を使います。  
> - `create`はバリデーションを自動でしないため、事前にチェック推奨です。

### Eloquentのイベントとメソッドまとめ

#### イベントとは
Eloquentモデルで、データの保存や削除など**特定のアクションの前後に自動で呼び出される処理**です。
 データの整合性確保や、処理自動化によく使われます。
＊アクションの前後で自動的に呼び出されるので、うまく活用すれば、煩雑な処理を削減したり、自動化したりすることができる。

主なイベント種類：
- **creating**: レコード作成前
- **created**: レコード作成後
- **updating**: レコード更新前
- **updated**: レコード更新後
- **saving**: 保存前（新規作成＋更新）
- **saved**: 保存後
- **deleting**: 削除前
- **deleted**: 削除後

> イベントを使いすぎると、タイミング管理が難しくなるので注意。

---

#### 主なイベントの例

#### saving  
保存直前に処理を実行  
（例：name属性を大文字に変換）

```php
class User extends Model
{
    protected static function boot()
    {
        parent::boot();

        static::saving(function ($user) {
            $user->name = ucfirst($user->name);
        });
    }
}
```

---

#### creating  
新規作成直前に処理を実行  
（例：signup_date属性に現在日時を設定）

```php
class User extends Model
{
    protected static function boot()
    {
        parent::boot();

        static::creating(function ($user) {
            $user->signup_date = now();
        });
    }
}
```

---

#### updating  
更新直前に処理を実行  
（例：updated_at属性に現在日時を設定）

```php
class User extends Model
{
    protected static function boot()
    {
        parent::boot();

        static::updating(function ($user) {
            $user->updated_at = now();
        });
    }
}
```

---

### saved  
保存後に処理を実行  
（例：ログ記録）

```php
class User extends Model
{
    protected static function boot()
    {
        parent::boot();

        static::saved(function ($user) {
            Log::info("User {$user->id} was saved at " . now());
        });
    }
}
```

---

### created  
新規作成後に処理を実行  
（例：ウェルカムメール送信）

```php
class User extends Model
{
    protected static function boot()
    {
        parent::boot();

        static::created(function ($user) {
            Mail::to($user->email)->send(new WelcomeMail($user));
        });
    }
}
```

---

#### updated  
更新後に処理を実行  
（例：更新時のログ記録）

```php
class User extends Model
{
    protected static function boot()
    {
        parent::boot();

        static::updated(function ($user) {
            Log::info("User {$user->name}'s profile was updated!");
        });
    }
}
```

---

#### クラスメソッドとインスタンスメソッド

#### クラスメソッド
- クラス自体に紐づくメソッド（`static`付き）
- クラス全体で共通の処理、一括操作などに使う
- コードの可読性・再利用性アップ

#### インスタンスメソッド
- オブジェクト（インスタンス）に紐づくメソッド
- 個々のデータや状態に応じて操作
- モデル内のロジック整理・再利用に役立つ

---

#### 公式ドキュメントの活用
理解が不十分な箇所があれば  
「Eloquent laravel.com」や「events laravel.com」で検索し、公式ドキュメントを読む習慣をつけましょう。  
慣れない間は技術記事も参考に、仕組みを大まかに掴むのがおすすめです。