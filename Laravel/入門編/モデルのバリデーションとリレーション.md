## モデルのバリデーションとリレーション

#### バリデーション

　バリデーションとは、ユーザーからの入力データが要件や仕様に適合しているのかを確認するプロセスのこと。ソフトウェアにおいて、ユーザーからの入力は正しい形式や範囲内である必要があるが、バリデーションを設けることによって、不正確なデータや予期しないデータがシステムに入力されることを防ぐことができる。

#### バリデーションヘルパー

### 主なバリデーションルール一覧（Laravel）

| ルール名    | 用途・説明                                       | 例（バリデーション記法）                                 | 備考・代表的な用途                 |
| ----------- | ------------------------------------------------ | -------------------------------------------------------- | ---------------------------------- |
| required    | 入力が必須。空欄の場合はエラー。                 | `'username' => 'required'`                               | ユーザー名・メールなど必須項目     |
| confirmed   | 入力値が確認用フィールドと一致しているか。       | `'password' => 'required|confirmed'`                     | パスワード再入力確認など           |
| regex       | 正規表現で形式をチェック。                       | `'email' => 'required|regex:/^[\w\.-]+@[\w\.-]+\.\w+$/'` | メール・電話番号等フォーマット確認 |
| min / max   | 文字数や数値の最小/最大値を制限。                | `'username' => 'required|min:3|max:20'`                  | ユーザー名・パスワード等の長さ制限 |
| integer     | 整数のみ許可。数値以外はエラー。                 | `'age' => 'required|integer'`                            | 年齢・数量・価格等                 |
| unique      | データベースで一意かどうかを確認。重複はエラー。 | `'email' => 'required|email|unique:users,email'`         | メール・ユーザーID等の重複防止     |
| sometimes   | リクエストに値がある場合のみバリデーション。     | `'discount' => 'sometimes|integer'`                      | オプション項目など                 |
| required_if | 条件付き必須。指定条件に合致した場合のみ必須。   | `'age' => 'required_if:role,admin|integer'`              | 管理者のみ必須項目等               |

---

### 初学者向け補足

- **required** … 必須項目。未入力の場合は必ずエラーになります。
- **confirmed** … 例えば「password」と「password_confirmation」が両方一致しているかを自動でチェックします。
- **regex** … 入力値が、指定したパターン（形式）に合っているか確認できます。複雑な入力ルールも作れます。
- **min / max** … ユーザー名やパスワードなど、長すぎ・短すぎを防ぐために使います。
- **unique** … 例えば同じメールアドレスで複数登録されないようにできます。
- **sometimes, required_if** … 入力値や状況によってバリデーションの必要が変わる場合に便利です。

> バリデーションは、ユーザーからの入力値を安全かつ正しく扱うための仕組みです。<br>
> 適切に設定することで、不正なデータや重複データを防ぐことができます。

---
### さらに学びたい方へ

- [Laravel公式バリデーションドキュメント](https://laravel.com/docs/validation)

### リレーション

　リレーション（Eloquent Relationships）は、Eloquent ORMを使用して、モデル間の関連付けを表現するための機能
DBのテーブル間の関連性を表現し、異なるモデル間でのDBの取得や操作を容易にする

### 主なリレーションの種類

| リレーション名 | 関係の内容                             | 例・代表的な用途                            | 備考・補足                                 |
| -------------- | -------------------------------------- | ------------------------------------------- | ------------------------------------------ |
| belongsTo      | モデルが他モデルに従属する             | BookがAuthorに属する                        | 外部キーは「従属する側」のテーブルに存在   |
| hasOne         | 一方のモデルが一つの他モデルを所有する | SupplierがAccountを持つ                     | 外部キーは「所有される側」のテーブルに存在 |
| hasMany        | モデルが複数の他モデルを所有する       | Authorが複数のBookを持つ                    | 一対多の典型例                             |
| hasManyThrough | 中間モデルを介して多対多を設定         | CountryがFlightsを通じPassengerと関係       | 2段階のリレーションを一度に取得            |
| hasOneThrough  | 中間モデルを介して一対一を設定         | SupplierがAccountを通じAccountHistoryと関係 | 2段階の一対一関係を一度に取得              |
| belongsToMany  | 中間テーブルを介して多対多を設定       | UserとRoleが互いに多対多の関係              | pivotテーブル（中間テーブル）が必要        |

---

### よく使われるリレーション例

#### 一対多（One-to-Many）
- 例：ブログ記事（Post）とコメント（Comment）
- モデル定義例（Postモデルの中）：
    ```php
    public function comments()
    {
        return $this->hasMany(Comment::class);
    }
    ```

#### 多対多（Many-to-Many）
- 例：ユーザー（User）と権限（Role）
- モデル定義例（Userモデルの中）：
    ```php
    public function roles()
    {
        return $this->belongsToMany(Role::class);
    }
    ```

#### 一対一（One-to-One）
- 例：ユーザー（User）とプロフィール（Profile）
- モデル定義例（Userモデルの中）：
    ```php
    public function profile()
    {
        return $this->hasOne(Profile::class);
    }
    ```

---

### 選択のポイント
- **belongsTo / hasOne**：外部キーの位置で選択（どちらのテーブルに外部キーがあるか）
- **hasManyThrough / belongsToMany**：中間モデルや中間テーブルが必要かどうか

---

### 公式ドキュメントの活用
リレーションの便利なメソッドや詳細は  
「[Laravel公式Eloquent: Relationships](https://laravel.com/docs/eloquent-relationships)」  
を参照してください。

---

### 初学者向け補足
- リレーションを使うことで、関連データの取得・保存が簡単にできます。
- モデル間の関係を**宣言的**に定義することで、コードが整理され、保守性も向上します。
- どのリレーションを使うか迷ったら、**外部キーの位置**や**中間テーブルの有無**を確認しましょう。



#### コメント

 railsと違って、バリデーションはそれぞれのメソッドごとに書く必要があるみたいですね。
記述をまとめることができるなら、そうしたいところですが....
