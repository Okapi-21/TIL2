## 検索機能実装

#### 検索とは



#### 検索用ルーティングの定義方法（`src/routes/web.php`）

---

##### 1. ルート定義例

```php
<?php

// ...省略...

Route::get('/boards/search', [BoardController::class, 'search'])->name('boards.search');
Route::resource('boards', BoardController::class);

// ...省略...

require __DIR__.'/auth.php';
```

---

##### 2. 各ルートの意味

- `Route::get('/boards/search', [BoardController::class, 'search'])->name('boards.search');`
  - HTTP GETメソッドで `/boards/search` にアクセスした時、
  - `BoardController`の`search`メソッドが呼ばれます。
  - ルート名は`boards.search`なので、Bladeやコントローラ内で`route('boards.search')`と参照できます。

- `Route::resource('boards', BoardController::class);`
  - `boards`に関するRESTfulな一括ルーティング（一覧、詳細、作成、更新、削除など）を自動で定義します。

---

##### 3. **記述順の重要性**

- 検索ルート（`/boards/search`）は**必ずリソースルーティングより上に記載**しましょう。
- 理由：
  - Laravelはルーティングを「上から順番」に解決します。
  - `Route::resource('boards', ...)`より下に`Route::get('/boards/search', ...)`を書いてしまうと、
    `/boards/search`が`/boards/{board}`（詳細ページ）の一部として解釈されてしまい、  
    検索機能が正しく動作しなくなる可能性があります。

---

##### 初学者向け補足

- 「検索ルートは上に！」と覚えましょう。  
  順番が大切な理由は、先にマッチしたものが優先されるからです。
- ルート名（name）は、`route('boards.search')`のように使うことでURLの変更に強く、保守性が高まります。

---

##### まとめ

- 検索用ルートはリソースルーティングより上に記載
- ルート名指定でコード管理が簡単
- Laravelはルーティングを記述順で解決するので順番に注意！

---



#### Searchメソッドについて

```php
public function search(Request $request)
    {
        $q = $request->input('q');
        $boards = Board::with('user', 'bookmarks')->where('title', 'like', "%$q%")
                      ->orWhere('description', 'like', "%$q%")->paginate(20);
        return view('boards.index', compact('boards'));
    }
```

　リクエストより受け取った変数を$qへ格納する。（qはユーザーが入力した検索キーワード）

Board::with('user', 'bookmarks')->where('title', 'like', "%$q%") でBardモデルに対して、クエリを発行
'title'カラムに対してLIke検索を行い、%qを含むタイトルを持つBoardを検索する。

->orWhere('description', 'like', "%$q%")はOR 条件で、'description' カラムに対しても同様の LIKE 検索を行う。

これにより、タイトルまたは説明文にキーワードを含むBoardが検索される。



#### view

```
<div class="m-3 mx-32">
        <form action="{{ route('boards.search') }}" method="GET" class="mt-3 flex overflow-hidden w-1/2">
            <input type="text" class="appearance-none border border-slate-300 rounded py-2 px-3 text-gray-700 w-2/3"
                name="q" placeholder="Search..." dusk="search-input" />
            <button class="py-2 px-4 border rounded ml-2" dusk="search-button">
                <i class="ri-search-line"></i>
                <span>検索</span>
            </button>
        </form>
    </div>
```

##### 検索フォーム

- **action="{{ route('boards.search') }}"**
   → 検索フォームをどのURLに送るか決めています。`web.php`で`boards.search`という名前で登録されたルートへ送信します。
- **method="GET"**
   → 検索キーワードをURLのパラメータとして送る（例: `?q=キーワード`）。データの取得に使う一般的な方法です。
- **name="q"**
   → 入力欄につける名前。ユーザーが入力した値は`q`という名前でサーバーに送られます。コントローラーの`search`メソッドで`$request->q`などで取得できます。
- **dusk="search-input" / dusk="search-button"**
   → Laravel Duskという自動テストツールで要素を操作しやすくするための目印です。普段は気にしなくてOK。

##### ページネーション（if 文の条件分岐の部分）

- **ページネーションとは？**
   → 掲示板の一覧がたくさんある時に「1ページ目」「2ページ目」…と分けて表示し、リンクで移動できる仕組みです。
- **request()->has('q')**
   → 今のリクエストに`q`パラメータ（検索キーワード）が含まれているかチェックしています。
- **検索している場合（if文の中）**
   → 検索キーワードを含めてページ送りリンクを作る
    例: `?q=Laravel&page=2`
    → こうすることで、ページ移動しても検索条件が消えません。
- **検索していない場合（else）**
   → 普通のページ送りリンクを表示（例: `?page=2`）