## 画像投稿機能の実装

### 実装課題

- 設定を整える
- マイグレーションファイル
  - bordモデルに画像投稿を可能とするための新しい属性を追加する必要がある
  - マイグレーションファイルに追記 or 新しくマイグレーションファイル作成 → マイグレーション実行
- ビュー
  - index部分では投稿画像を表示するためのロジックを追加する必要あり
  - create部分では画像投稿のためのフォームを追加で入力する必要がある
- コントローラー
  - bordコントローラーでは一括代入を許す変数の追加する必要あり
  - store 処理でのバリデーション追記・属性追加設定



### シンボリックリンクの設定と `php artisan storage:link` コマンド

---

#### 1. シンボリックリンクとは？

- **シンボリックリンク（Symbolic Link）**は、コンピュータでファイルやフォルダへの「参照」を作成する仕組みです。
- 実際のデータを複製するのではなく、「ここに元データがあるよ」と指し示す**ポインタのような役割**を持ちます。
- 例えば、Aというフォルダに保存した画像を、Bという場所からもアクセスできるようにしたいときに便利です。
- **データの重複を防ぎつつ、複数の場所から同じデータを利用できる**のが特徴です。

---

#### 2. 初学者向け補足

- 「ショートカット」や「エイリアス」のようなものと考えると分かりやすいです。
- 画像やファイルをアプリで表示したい場合、**本体（storage）を傷つけずに表側（public）からアクセスできる**ようにします。

---

#### 3. Laravelでのシンボリックリンク作成

Laravelのアプリケーションでは、  
アップロードされた画像やファイルは、基本的に`storage/app/public`ディレクトリに保存されます。

**しかし、Web画面にファイルを表示するには「public」ディレクトリからアクセスできる必要があります。  
そのために「シンボリックリンク」を使います。**

---

#### 4. コマンドの使い方

```bash
docker compose exec app php artisan storage:link
```

- 上記コマンドをターミナルで実行すると、  
  `public/storage` という場所に、`storage/app/public` へのシンボリックリンクが自動で作成されます。
- これによって、**Webページから画像などのファイルを簡単に表示できるようになります。**

---

#### 5. まとめ

- シンボリックリンクは「元データへの案内板」
- Laravelでは、`storage:link`で画像・ファイルの公開が簡単になる
- **ファイルアップロード機能を使うときは、必ずこのコマンドを実行しておきましょう**

---

#### 6. トラブルシューティング

- コマンド実行後、`public/storage`が存在しない場合は、再度コマンドを実行する
- 権限エラー等が出る場合は、管理者権限で再実行することも検討してください

---



### Veiw

#### index画面

```
<img class="rounded-t-lg" src="{{ Storage::url("images/".$board->image) }}" alt="" />
```

- `Storage::url(...)`
  Laravelの「ストレージ」に保存されているファイルの「公開URL」を作る関数です。
- `"images/" . $board->image`
  画像ファイルの保存場所（`images`フォルダ）と、画像ファイル名（例：`no_image.jpg`や`board1.jpg`）をくっつけています。
- `$board->image`
  これは「掲示板（Board）」のレコードに保存されている画像ファイル名です。

具体的には

1. 例えば `$board->image` が `"no_image.jpg"` だった場合
2. `"images/" . $board->image` で `"images/no_image.jpg"` という文字列になります
3. `Storage::url("images/no_image.jpg")` で、
   　　`/storage/images/no_image.jpg` などの「公開URL」が作られます
4. そのURLを `<img src="...">` の中に入れることで、
   　　ブラウザで画像が表示されます

#### create画面

```
<form class="rounded mb-4" method="POST" action="{{ route('boards.store') }}" enctype="multipart/form-data">
```

#### Createの補足：ファイルアップロード時の `enctype="multipart/form-data"` の役割

フォームでファイル（画像など）をサーバーに送信したい場合、  
`enctype="multipart/form-data"` という属性が**必ず必要**です。

- この属性が付いていると、ファイルのバイナリデータを含めてフォームデータをサーバーへ送信できます
- 例えば、画像アップロード機能などで使われます。
- **注意：ファイルを送るフォームには必ず設定してください**。これがないとファイルは送信されません。

---

#### ファイル選択フィールド `<input type="file">` の解説

```html
<input id="board_image" class="w-full leading-tight" type="file" name="board_image">
```

- **id="board_image"**  
  このフィールドの識別子です。CSSやJavaScriptで参照するときに使います。
- **class="w-full leading-tight"**  
  デザイン（CSS）用の指定です。  
  - `w-full`：幅を親要素いっぱいに広げる
  - `leading-tight`：行間や要素間のスペースを詰める
- **type="file"**  
  このフィールドが「ファイル選択用」であることを示します。  
  ユーザーはここで画像などのファイルを選べます。
- **name="board_image"**  
  フォーム送信時にサーバー側でこの名前で受け取ります。  
  サーバー側で「board_image」という名前のファイルデータが取得できます。

---

#### 初学者向け補足

- フォームタグに`enctype="multipart/form-data"`を付ける理由は「ファイルを送るため」と覚えてください。
- `<input type="file">`は画像やPDFなど、**ユーザーがパソコンやスマホからファイルを選ぶための部品**です。
- `name`属性はサーバーへの「荷札」のようなもの。サーバーはこの名前で受け取ります。

---

#### まとめ

- ファイルアップロード機能を作る時は、**フォームタグに必ず`enctype="multipart/form-data"`を設定しましょう**。
- ファイル選択欄には`<input type="file" name="...">`を使いましょう。
- サーバー側では`name`で指定した名前でファイルデータを取り出せます。

---



### controller

Boardcontroller へ 追記したもの
```
if ($request->hasFile('board_image')) {
    $filename = $request->file('board_image')->store('public/images');
    $board->image = basename($filename);
}
```

#### 各処理の意味

#### 1. `$request->hasFile('board_image')`
- フォームから送信されたリクエストに「board_image」という名前のファイルが含まれているかをチェックします。
- 画像がアップロードされた場合のみ、後続の処理が実行されます。

#### 2. `$request->file('board_image')->store('public/images')`
- アップロードされた画像ファイルを `storage/app/public/images` ディレクトリに保存します。
- 保存後、**ファイルの保存先パス**を返します（例: `public/images/xxxx.jpg`）。

#### 3. `$board->image = basename($filename);`
- `basename`関数で、保存された画像ファイルの「ファイル名部分」だけを抜き出します。
- そのファイル名をBoardモデルの`image`属性にセットします。
- こうすることで、データベースには画像ファイル名が保存され、画像を表示する際にパスを組み立てて参照できます。

---

### 各処理の意味

#### 1. `$request->hasFile('board_image')`
- フォームから送信されたリクエストに「board_image」という名前のファイルが含まれているかをチェックします。
- 画像がアップロードされた場合のみ、後続の処理が実行されます。

#### 2. `$request->file('board_image')->store('public/images')`
- アップロードされた画像ファイルを `storage/app/public/images` ディレクトリに保存します。
- 保存後、**ファイルの保存先パス**を返します（例: `public/images/xxxx.jpg`）。

#### 3. `$board->image = basename($filename);`
- `basename`関数で、保存された画像ファイルの「ファイル名部分」だけを抜き出します。
- そのファイル名をBoardモデルの`image`属性にセットします。
- こうすることで、データベースには画像ファイル名が保存され、画像を表示する際にパスを組み立てて参照できます。

---

### 各処理の意味

#### 1. `$request->hasFile('board_image')`
- フォームから送信されたリクエストに「board_image」という名前のファイルが含まれているかをチェックします。
- 画像がアップロードされた場合のみ、後続の処理が実行されます。

#### 2. `$request->file('board_image')->store('public/images')`
- アップロードされた画像ファイルを `storage/app/public/images` ディレクトリに保存します。
- 保存後、**ファイルの保存先パス**を返します（例: `public/images/xxxx.jpg`）。

#### 3. `$board->image = basename($filename);`
- `basename`関数で、保存された画像ファイルの「ファイル名部分」だけを抜き出します。
- そのファイル名をBoardモデルの`image`属性にセットします。
- こうすることで、データベースには画像ファイル名が保存され、画像を表示する際にパスを組み立てて参照できます。

---

### 初学者向け補足

- **ファイルアップロード機能**は、フォームで画像ファイルを選んで送信するときに使います。
- 保存先は「storage/app/public/images」ですが、  
  Webから表示するには「storage:link」コマンドでpublicディレクトリに案内板（シンボリックリンク）を作っておく必要があります。
- データベースには「ファイル名」だけ保存しておき、画像表示時にパスを組み立てて使うのが一般的です。

---