# Claude Code を使用したAI駆動開発基礎知識

**作成日:** 2026年2月21日
**対象:** Claude Code を使った日常開発のコマンド・操作・フロー

---

## 毎日使う基本コマンド

### 起動・終了

```bash
claude                    # 起動（プロジェクトルートで実行すること）
claude -c                 # 前回のセッションの続きから再開
claude --resume           # 過去セッション一覧から選んで再開
Ctrl+C                    # 終了（セッション中に2回押す）
Escape                    # Claude の生成を途中で止める（終了はしない）
```

`claude` は必ずプロジェクトルート（project`/`）で起動する。CLAUDE.md が自動で読み込まれる。

### セッション中のスラッシュコマンド

```bash
/help                     # 全コマンド一覧を表示
/clear                    # 会話履歴をクリア（新しいIssueに着手する時に使う）
/compact                  # 会話履歴を要約して圧縮（コンテキストが長くなった時）
/compact 認証の実装内容とDB設計の判断は保持して
                          # ↑ 残したい内容を指示して圧縮もできる
/history                  # 過去のセッション一覧
/init                     # CLAUDE.md を自動生成（既にあるなら不要）
```

**特に重要なのは `/clear` と `/compact`。** 新しい Issue に着手する時は `/clear`、同じ Issue 内で会話が長くなってきたら `/compact`。

### ファイル参照とシェル実行

```bash
@CLAUDE.md                # ファイルをコンテキストに追加
@issues.md                # 複数ファイルも同時に参照できる
@backend/app/Services/    # ディレクトリ全体も参照可能
!docker compose ps        # シェルコマンドを直接実行（Claude を経由せず）
!git status               # Claude に聞くまでもない確認に便利
```

`@` はファイルの中身を Claude に読ませる。`!` はコマンドをその場で実行する。

---

## Plan Mode

```bash
Shift+Tab                 # Plan Mode ↔ 通常モードの切り替え
```

Plan Mode では設計・計画だけを出力し、コード生成やコマンド実行は行わない。
Issue に着手する前に Plan Mode で計画を立て、`Shift+Tab` で通常モードに切り替えて実装する。

---

## 権限・設定関連

```bash
/allowed-tools            # 自動承認するツールの一覧を表示・設定
/model                    # 使用モデルを切り替え（Opus ↔ Sonnet）
/cost                     # 現在のセッションのトークン消費量・コストを表示
```

### `/allowed-tools` について

Claude Code がファイル編集やコマンド実行の許可を求めてきた時に「Always allow」を選ぶと、そのツールが `/allowed-tools` に追加される。CLAUDE.md で自動承認と定義した操作（テスト実行、Docker操作等）は積極的に「Always allow」する。

### `/model` の使い分け

| モデル                 | 使う場面                                                   |
| ---------------------- | ---------------------------------------------------------- |
| **Opus（デフォルト）** | 設計判断が必要な場面、複雑なロジック、プロンプト設計       |
| **Sonnet**             | テスト作成、定型的なCRUD、ドキュメント生成、単純なバグ修正 |

Sonnet は Opus より安くて速い。単純作業では切り替えるとコスト効率が良い。

---

## Git 連携

```bash
# Claude に頼む形
「変更をコミットしてください。メッセージは日本語で。」

# 自分で直接実行する形（! 付き）
!git status
!git diff
!git log --oneline -10
```

**注意:** `git push` は自分で実行する方が安全。意図しないブランチに push するリスクを避けるため。

---

## CLI フラグ（起動時のオプション）

```bash
claude -p "テストを実行して結果を教えて"
                          # -p: ワンショット実行（対話なし、結果だけ返す）
                          # CI/CDや簡単な確認に便利

claude -c                 # 前回セッションを再開

claude --output-format json -p "..."
                          # JSON形式で出力（スクリプト連携用）

claude --append-system-prompt "全ての応答を日本語で行うこと"
                          # システムプロンプトに追加指示
                          # CLAUDE.md があるなら通常は不要

claude -w                 # git worktree を使った隔離セッション
                          # 並列作業で使う（メインブランチを汚さない）
```

### 特に重要なフラグ

**`-p`（ワンショット）:** 対話なしでコマンド1つだけ実行したい時。

```bash
claude -p "php artisan test を実行して、失敗したテストがあれば原因を教えて"
```

**`-w`（worktree）:** 並列作業で2つの Claude Code インスタンスを走らせる時に使う。git worktree で別ブランチを自動作成し、メインブランチを汚さずに作業できる。

---

## 知っておくと便利な操作

```bash
Escape → Escape           # 過去のメッセージ一覧を表示（ジャンプバック）
↑                         # 直前の自分の入力を再表示（修正して再送信できる）
```

---

## ターミナルログの保存方法

Claude Code のセッションを後から見返せるようにログを残す方法。

```bash
# 方法1: tee コマンド（シンプル）
claude | tee logs/session_$(date +%Y%m%d_%H%M%S).log

# 方法2: script コマンド（カラーコード含めて記録）
script -q logs/session_$(date +%Y%m%d_%H%M%S).log
claude
# 作業終了後に exit で記録終了
```

`logs/` ディレクトリを事前に作っておくこと。

---

## 日常の開発フロー

```bash
# 1. プロジェクトルートで起動
cd project
claude

# 2. 新しいIssueに着手する時
/clear
Shift+Tab                       # Plan Mode ON
@CLAUDE.md と @issues.md を読んで、Issue #4 の実装計画を立ててください。

# 3. 計画を確認して実装に移行
Shift+Tab                       # Plan Mode OFF（通常モードへ）
上の計画に沿って、まずテストを書いてください。

# 4. 実装中にコスト確認
/cost

# 5. 会話が長くなったら圧縮
/compact EmbeddingServiceのテスト内容と実装判断は保持して

# 6. Issue完了（Claude が自動で CLAUDE.md 更新 → commit）

# 7. 次の Issue へ
/clear
次は Issue #5 です。@CLAUDE.md を読んで計画を立ててください。

# 8. 終了
Ctrl+C Ctrl+C
```

---

## 備考

#### Claude Code ベース開発のポイント（別途メモ）

#### コンテキスト管理

- 1セッション = 1〜3 Issue に絞る
- CLAUDE.md を常に最新に保つ
- 長いエラーログはそのまま貼らず要約して渡す

#### 指示の出し方

- 曖昧な依頼より具体的な制約付きの依頼
- 使用ライブラリ、出力先ファイル、エラーハンドリング方針を明示する

#### TDD との連携

- テストを先に書かせる → 全FAIL確認 → 実装を任せる → 全GREEN確認
- テストが「仕様書」になるので Claude Code が迷わない

#### Claude Code が得意なこと

- 新規ファイル作成（モデル、マイグレーション、サービスクラス、コンポーネント）
- テストコード生成
- 定型的なCRUD実装
- エラーメッセージからの原因特定と修正

#### Claude Code が苦手なこと

- 複数ファイルにまたがる大規模リファクタリング
- 既存の大きなコードベースの全体把握
- Docker内のパーミッション等の環境依存問題
- デザインの細かい調整

#### デバッグ時の伝え方

- エラーの核心部分をテキストで渡す（スクショではなく）
- 期待する動作を伝える
- 実行したコマンドを正確に伝える

#### Claude.ai（Web版）との使い分け

|        | Claude Code                            | Claude.ai                          |
| ------ | -------------------------------------- | ---------------------------------- |
| 得意   | コード実装、ファイル操作、コマンド実行 | 設計相談、方針決定、プロンプト作成 |
| 使い方 | 「これを実装して」                     | 「この設計どう思う？」             |

実装で詰まったらエラー内容を Claude.ai に持っていき、方針を相談してから Claude Code に戻る方が効率的なケースも多い。